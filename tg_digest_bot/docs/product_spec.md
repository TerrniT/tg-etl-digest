# Product Spec: Telegram Digest Bot

## 1. Цель
Система должна позволять пользователю Telegram-бота сохранять собственный список каналов и по команде `/analytic` получать дайджест: summary последних 5 текстовых постов по каждому каналу + ссылка на канал (опционально ссылки на посты).

## 2. Пользовательский сценарий (Happy Path)
1. Пользователь отправляет `/add @channel1 @channel2 ...`.
2. Бот сохраняет каналы без дублей.
3. Пользователь отправляет `/analytic`.
4. Система собирает по каждому каналу последние 5 текстовых постов, очищает текст, суммаризирует и отправляет дайджест.

## 3. Команды
- `/start` — приветствие и краткая инструкция.
- `/add` — добавить один или несколько каналов.
- `/list` — показать сохранённые каналы.
- `/remove @channel` — удалить канал.
- `/analytic` — сформировать дайджест.

## 4. Ограничения доступа Telegram
- Bot API не подходит для универсального чтения чужих каналов.
- Для Extract-слоя требуется MTProto-клиент (например, Telethon) с user-session.
- Приватные каналы доступны только если user-session имеет доступ.

## 5. Функциональные требования
### 5.1 Каналы пользователя
- Персистентное хранение в БД.
- Добавление идемпотентно, без дублей.
- Лимит каналов на пользователя: `MAX_CHANNELS_PER_USER = 200`.

### 5.2 `/analytic`
Для каждого канала:
- ссылка вида `https://t.me/<handle>`;
- summary на русском (4–8 буллетов);
- при включенной опции — ссылки на последние посты.

## 6. Нефункциональные требования
- Предсказуемое время ответа.
- Устойчивость к Telegram rate limits/FloodWait.
- Ошибка по одному каналу не должна ломать весь ответ.
- Чанкинг сообщений с учётом лимита Telegram.

## 7. Acceptance Criteria
1. `/add` + `/list` работают и показывают сохранённые данные.
2. `/analytic` для одного канала возвращает summary последних 5 постов + ссылку на канал.
3. `/analytic` для нескольких каналов возвращает отдельные блоки.
4. Недоступный канал отображается как ошибка только в своём блоке.
5. При отсутствии текстовых постов возвращается корректный fallback.
6. Длинный дайджест режется на несколько сообщений без потери блоков.
7. Повторный `/add` не создаёт дублей.
